<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Engineer Attendance Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Urbanist:wght@500;800&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/jquery@3.7.1/dist/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyA97qnWyZu_Id_BCQhWvwOhm6qxn0TPty8&libraries=places"></script>
<style>
body{font-family:'Urbanist',sans-serif;background:linear-gradient(120deg,#0e141f,#1b2233);color:#d1d4dc;}
.navbar{background:linear-gradient(90deg,#1c1f32,#23355a);}
.nav-link{color:#d1d4dc!important}.nav-link.active,.nav-link:hover{color:#6da9ff!important;cursor:pointer;}
.section{display:none;opacity:0}.section.active{display:block;opacity:1}
#container-main{max-width:1100px;margin:2rem auto;padding:2rem;background:rgba(27,32,52,0.9);border-radius:22px;}
.section-card{background:linear-gradient(115deg,#191d29 30%,#273970 120%);border-radius:24px;padding:1.5rem;margin-bottom:2rem;}
.section-title{font-size:1.4rem;font-weight:800;color:#43bfff;margin-bottom:1rem}
#map-wrapper{position:relative;height:330px;border-radius:18px;margin-bottom:1.2rem;background:#1a2030;}
#pac-input{position:absolute;top:18px;left:50%;transform:translateX(-50%);width:92%;max-width:520px;padding:0.7rem 1.4rem;border-radius:14px;border:1.7px solid #4673c5;background:#28376f;color:#d9e2ff;font-size:1.1rem;z-index:10;}
#map{width:100%;height:100%;border-radius:18px;}
.attendance-card{background:linear-gradient(110deg,#23294b 82%,#1c1b2b 95%);border-radius:16px;margin-bottom:0.7rem;padding:0.7rem 1.1rem;display:flex;flex-direction:column;gap:0.4rem;opacity:0;transition:transform .15s;}
.attendance-card:hover{transform:scale(1.02);background:linear-gradient(120deg,#2c4478 2%,#334bf9 100%);color:#fff;}
.status-dot{width:14px;height:14px;border-radius:50%;display:inline-block;}
.completed{background:#69e07b}.pending{background:#f1da65}
.card-summary{display:flex;align-items:center;gap:10px;}
.card-place{font-weight:700;font-size:1.06rem;color:#aec4ff;flex-grow:1;}
.card-date{font-size:.92rem;opacity:.72;font-weight:600;}
.photo-label{font-size:.85rem;font-weight:700;color:#c0dcfa;}
.time-label{font-weight:600;font-size:.93rem;color:#bbe3fa;}
#action-alert{font-weight:600;min-height:32px;border-radius:13px;background:#2434aa26;border:2px solid #5e73d2bb;color:#bedeff;margin-top:1rem;padding:0.3rem 1.1rem;text-align:center;opacity:0;}
#camera-overlay{position:fixed;top:0;left:0;width:100vw;height:100vh;background:#000c;display:none;align-items:center;justify-content:center;z-index:9999;flex-direction:column;}
#camera-controls{margin-top:1rem;display:flex;gap:1rem;justify-content:center;}
.admin-user-row{cursor:pointer;font-weight:600;text-shadow:0 1px 6px #2848bb55;transition:background 0.25s,color 0.25s;}
.admin-user-row:hover{background:#0d2a5b!important;color:#fff;}
.list-group-item{padding:8px 12px;}
.admin-record-table tr:hover{background:rgba(77,137,255,0.15);}
.admin-record-table{font-size:0.95em;}
@media(max-width:680px){
  #container-main{padding:1rem;}
  .card-summary{flex-wrap:wrap;}
  #pac-input{max-width:96%;font-size:1rem;}
  #camera-overlay video{max-width:96vw;}
}
</style>
</head>
<body>

<nav class="navbar navbar-expand-lg mb-3">
 <div class="container-fluid">
  <a class="navbar-brand text-light"><i class="bi bi-clock-history"></i> Attendance</a>
  <button class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#navMain"><span class="navbar-toggler-icon"></span></button>
  <div class="collapse navbar-collapse" id="navMain">
   <ul class="navbar-nav me-auto">
    <li><a class="nav-link active" data-sec="dashboard">Dashboard</a></li>
    <li><a class="nav-link" data-sec="statistics">Statistics</a></li>
    <li><a class="nav-link" data-sec="profile">Profile</a></li>
    <li class="admin-only"><a class="nav-link" data-sec="admin">Admin Dashboard</a></li>
    <li><a class="nav-link" data-sec="help">Help</a></li>
   </ul>
   <span id="user-name" class="text-light me-3"></span>
   <button id="logout" class="btn btn-outline-light btn-sm">Logout</button>
  </div>
 </div>
</nav>

<div id="container-main">
<!-- Dashboard -->
<div class="section active" id="dashboard">
 <div class="section-card">
  <div class="section-title"><i class="bi bi-map"></i> Dashboard</div>
  <div id="map-wrapper">
    <input id="pac-input" placeholder="Search site or address"/>
    <div id="map"></div>
  </div>
  <div class="d-flex justify-content-center gap-3 my-3">
    <button id="checkin-btn" class="btn btn-success"><i class="bi bi-box-arrow-in-right"></i> Mark Entry</button>
    <button id="checkout-btn" class="btn btn-warning"><i class="bi bi-box-arrow-right"></i> Mark Exit</button>
  </div>
  <div id="action-alert"></div>
  <div class="d-flex flex-wrap align-items-center gap-2 mb-2">
    <label class="profile-label mb-0">Show:</label>
    <select id="filter-select" class="form-select form-select-sm" style="max-width:150px;">
      <option value="all">All</option><option value="yesterday">Yesterday</option>
      <option value="last7">Last Week</option><option value="last30">Last Month</option>
      <option value="custom">Custom Range</option>
    </select>
    <input type="date" id="start-date" style="display:none;">
    <input type="date" id="end-date" style="display:none;">
  </div>
  <div id="attendance-cards"></div>
 </div>
</div>

<!-- Statistics -->
<div class="section" id="statistics">
 <div class="section-card">
  <div class="section-title"><i class="bi bi-bar-chart-line"></i> Statistics</div>
  <div id="statistics-holder"></div>
 </div>
</div>

<!-- Profile -->
<div class="section" id="profile">
 <div class="section-card">
  <div class="section-title"><i class="bi bi-person-circle"></i> Profile</div>
  <form id="profile-form">
    <div class="mb-2"><label class="profile-label">Email</label><input id="prof-email" class="form-control" disabled></div>
    <div class="mb-2"><label class="profile-label">Username</label><input id="prof-username" class="form-control"></div>
    <div class="mb-2"><label class="profile-label">Full Name</label><input id="prof-fullname" class="form-control"></div>
    <div class="mb-2"><label class="profile-label">Contact</label><input id="prof-contact" class="form-control"></div>
    <button class="btn btn-primary mt-2" type="submit">Save</button>
  </form>
  <div id="profile-save-result" class="mt-2"></div>
 </div>
</div>

<!-- Admin -->
<div class="section" id="admin">
 <div class="section-card">
  <div class="section-title"><i class="bi bi-people"></i> Admin Dashboard</div>
  <div id="admin-users-list" class="mb-3"></div>
  <div id="admin-user-details"></div>
  <button id="admin-export" class="btn btn-success btn-sm mb-3">Export Attendance Excel</button>
  <h5 class="text-info">Reported Issues</h5>
  <div id="admin-issues-holder"></div>
 </div>
</div>

<!-- Help -->
<div class="section" id="help">
 <div class="section-card">
  <div class="section-title"><i class="bi bi-question-circle"></i> Help</div>
  <form id="help-form">
    <label class="profile-label">Describe your issue</label>
    <textarea id="help-message" rows="4" maxlength="700" class="form-control mb-2"></textarea>
    <button type="submit" class="btn btn-primary">Send Message</button>
    <div id="help-response" class="mt-2 text-warning"></div>
  </form>
  <div class="mt-3">
    <label class="profile-label">Contact Us:</label><br>
    <a href="https://wa.me/9007947130" target="_blank" class="btn btn-success me-2"><i class="bi bi-whatsapp"></i> WhatsApp</a>
    <a href="tel:+919007947130" class="btn btn-info"><i class="bi bi-telephone"></i> Call</a>
  </div>
 </div>
</div>
</div>

<!-- Camera overlay -->
<div id="camera-overlay">
  <video id="video" autoplay playsinline style="max-width:90%;border-radius:14px;"></video>
  <div id="camera-controls">
    <button id="snap-btn" class="btn btn-primary"><i class="bi bi-camera"></i> Capture</button>
    <button id="flip-btn" class="btn btn-secondary"><i class="bi bi-arrow-repeat"></i> Flip</button>
    <button id="cancel-btn" class="btn btn-danger"><i class="bi bi-x-circle"></i> Cancel</button>
  </div>
  <canvas id="canvas" style="display:none;"></canvas>
</div>

<script>
const allowedAdminEmail="mainakdebnath13@gmail.com";
if(!sessionStorage.getItem("googleEmail")) location.href="login.html";
const userEmail=sessionStorage.getItem("googleEmail"), userName=sessionStorage.getItem("googleName")||"User";
$("#user-name").text(userName);
if(userEmail!==allowedAdminEmail) $('.admin-only').hide();
$('#logout').click(()=>{sessionStorage.clear();localStorage.removeItem("attendance_jobs__"+userEmail);location.href="login.html";});
function getJobs(u=userEmail){return JSON.parse(localStorage.getItem("attendance_jobs__"+u)||"[]");}
function setJobs(data,u=userEmail){localStorage.setItem("attendance_jobs__"+u,JSON.stringify(data));}
function getProfile(u=userEmail){return JSON.parse(localStorage.getItem("prof__"+u)||"{}");}
function setProfile(data,u=userEmail){localStorage.setItem("prof__"+u,JSON.stringify(data));}
function escape(t){return t?t.replace(/[&<>"]/g,m=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;"}[m])):"";}

$('.nav-link').click(function(){
  $('.nav-link').removeClass('active');$(this).addClass('active');
  let sec=$(this).data('sec');
  $('.section').removeClass('active').css({opacity:0});
  $('#'+sec).addClass('active');gsap.to('#'+sec,{opacity:1,duration:0.4});
});

let jobs=getJobs(),selectedPlace=null,userLat=null,userLng=null,map,marker,userLiveMarker,userAccuracyCircle;

// ZIP code extraction
function extractZipCode(place){
  if(!place.address_components)return"";
  let c=place.address_components.find(ac=>ac.types.includes("postal_code"));
  return c?c.long_name:"";
}

// Dashboard cards/filter
$("#filter-select").change(function(){$("#start-date,#end-date").toggle($(this).val()==='custom');renderAttendanceCards();});
$("#start-date,#end-date").on('change',renderAttendanceCards);
function sameDay(d1,d2){return d1.getFullYear()===d2.getFullYear()&&d1.getMonth()===d2.getMonth()&&d1.getDate()===d2.getDate();}
function filterArray(){let arr=[...jobs],f=$("#filter-select").val(),td=new Date();td.setHours(0,0,0,0);
  if(f==="yesterday"){let yd=new Date(td);yd.setDate(td.getDate()-1);return arr.filter(r=>sameDay(new Date(r.entryTime),yd));}
  if(f==="last7"){let wk=new Date(td);wk.setDate(td.getDate()-6);return arr.filter(r=>{let d=new Date(r.entryTime);d.setHours(0,0,0,0);return d>=wk&&d<=td;});}
  if(f==="last30"){let mk=new Date(td);mk.setDate(td.getDate()-29);return arr.filter(r=>{let d=new Date(r.entryTime);d.setHours(0,0,0,0);return d>=mk&&d<=td;});}
  if(f==="custom"){let sd=$("#start-date").val(),ed=$("#end-date").val();if(!sd||!ed) return [];let sdt=new Date(sd),edt=new Date(ed);sdt.setHours(0,0,0,0);edt.setHours(0,0,0,0);
    return arr.filter(r=>{let d=new Date(r.entryTime);d.setHours(0,0,0,0);return d>=sdt&&d<=edt;});}
  return arr;
}
function renderAttendanceCards(){
  let arr=filterArray(),c=$("#attendance-cards").empty();
  if(!arr.length) return c.html(`<p class='text-center text-muted'>No records.</p>`);
  arr.forEach((job,i)=>{
    let zipStr=job.zipcode?`, ${escape(job.zipcode)}`:"";
    let card=$(`<div class="attendance-card"><div class="card-summary">
      <span class="status-dot ${job.exitPhoto?"completed":"pending"}"></span>
      <span class="card-place">(${escape(job.place)}${zipStr})</span>
      <span class="card-date">${escape(job.entryTime.split(",")[0])}</span>
      <button class="btn btn-danger btn-sm delete-record-btn">Delete</button>
    </div>
    <div class="d-flex gap-3 py-2">
      <div><img src="${job.entryPhoto}" style="max-width:72px;border-radius:10px;"><div class="photo-label">Entry</div></div>
      ${job.exitPhoto?`<div><img src="${job.exitPhoto}" style="max-width:72px;border-radius:10px;"><div class="photo-label">Exit</div></div>`:""}
      <div>
        <div class="time-label">Entry:</div>${escape(job.entryTime)}
        ${job.exitPhoto?`<div class="time-label">Exit:</div>${escape(job.exitTime)}`:""}
      </div>
    </div></div>`);
    card.find('.delete-record-btn').click(()=>{if(confirm("Delete?")){jobs.splice(jobs.indexOf(job),1);setJobs(jobs);renderAttendanceCards();renderStatisticsTable();}});
    gsap.to(card,{opacity:1,duration:0.3,delay:i*0.05});c.append(card);
  });
}

// Map + Places API
function initMap(){
  map=new google.maps.Map(document.getElementById('map'),{center:{lat:28.61,lng:77.23},zoom:12});
  const options={componentRestrictions:{country:["in"]}};
  const input = document.getElementById('pac-input');
  const searchBox=new google.maps.places.SearchBox(input,options);
  function updateBounds(lat, lng) {
    if(lat&&lng){
      const circle=new google.maps.Circle({center:{lat,lng},radius:20000});
      searchBox.setBounds(circle.getBounds());
    }
  }
  if(navigator.geolocation){
    navigator.geolocation.watchPosition(function(position){
      userLat=position.coords.latitude;userLng=position.coords.longitude;updateBounds(userLat,userLng);
      const posLatLng={lat:userLat,lng:userLng};
      if(!userLiveMarker){
        userLiveMarker=new google.maps.Marker({
          position:posLatLng,map,
          icon:{path:google.maps.SymbolPath.CIRCLE,scale:8,fillColor:"#2977FF",fillOpacity:.8,strokeColor:"#fff",strokeWeight:2}});
        map.setCenter(posLatLng);map.setZoom(16);
        userAccuracyCircle=new google.maps.Circle({
          strokeColor:"#2977FF",strokeOpacity:0.4,strokeWeight:1,
          fillColor:"#2977FF",fillOpacity:0.1,map,center:posLatLng,radius:position.coords.accuracy});
      }else{userLiveMarker.setPosition(posLatLng);userAccuracyCircle.setCenter(posLatLng);}
    },()=>showAlert("Enable location for nearest results.",true),{enableHighAccuracy:true});
  }
  searchBox.addListener('places_changed',()=>{
    const places=searchBox.getPlaces();
    if(!places.length)return;selectedPlace=places[0];
    selectedPlace.zipcode=extractZipCode(selectedPlace);
    if(marker)marker.setMap(null);
    marker=new google.maps.Marker({map,position:selectedPlace.geometry.location,animation:google.maps.Animation.DROP,title:selectedPlace.name});
    map.panTo(selectedPlace.geometry.location);map.setZoom(16);
  });
}

// Camera
let usingFront=false,globalStream,entryPhoto="",exitPhoto="";
function openCamera(type){
  $("#camera-overlay").css("display","flex");
  function startCam(){if(globalStream)globalStream.getTracks().forEach(t=>t.stop());navigator.mediaDevices.getUserMedia({video:{facingMode:usingFront?'user':'environment'}}).then(stream=>{globalStream=stream;$("#video")[0].srcObject=stream;$("#video")[0].play();});}
  startCam();
  $("#snap-btn").off().click(()=>{
    const v=$("#video")[0],c=$("#canvas")[0];c.width=v.videoWidth;c.height=v.videoHeight;c.getContext('2d').drawImage(v,0,0);
    const img=c.toDataURL();
    if(type==='entry')entryPhoto=img;else exitPhoto=img;
    globalStream.getTracks().forEach(t=>t.stop());$("#camera-overlay").hide();finishAttendance(type);
  });
  $("#flip-btn").off().click(()=>{usingFront=!usingFront;startCam();});
  $("#cancel-btn").off().click(()=>{if(globalStream)globalStream.getTracks().forEach(t=>t.stop());$("#camera-overlay").hide();});
}
function finishAttendance(type){
  if(type==='entry'){jobs.unshift({place:selectedPlace?.name||"Unknown",zipcode:selectedPlace?.zipcode||"",entryTime:new Date().toLocaleString(),entryPhoto,status:"pending-exit"});}
  else{let j=jobs.find(j=>j.status==="pending-exit");if(j){j.exitTime=new Date().toLocaleString();j.exitPhoto=exitPhoto;j.status="completed";}}
  setJobs(jobs);renderAttendanceCards();renderStatisticsTable();showAlert(type==='entry'?"Entry marked!":"Exit marked!",false);
}
$('#checkin-btn').click(()=>{if(!selectedPlace)return showAlert("Select place",true);if(getDistance(userLat,userLng,selectedPlace.geometry.location.lat(),selectedPlace.geometry.location.lng())<=400) openCamera('entry');else showAlert("Too far from site",true);});
$('#checkout-btn').click(()=>{if(!selectedPlace)return showAlert("Select place",true);if(!jobs.some(j=>j.status==="pending-exit"))return showAlert("No active job",true);if(getDistance(userLat,userLng,selectedPlace.geometry.location.lat(),selectedPlace.geometry.location.lng())<=400) openCamera('exit');else showAlert("Too far from site",true);});
function getDistance(lat1,lon1,lat2,lon2){const R=6371e3,toRad=d=>d*Math.PI/180;let dLat=toRad(lat2-lat1),dLon=toRad(lon2-lon1);let a=Math.sin(dLat/2)**2+Math.cos(toRad(lat1))*Math.cos(toRad(lat2))*Math.sin(dLon/2)**2;return R*2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a));}

// Profile
function loadProfile(){let p=getProfile();$("#prof-email").val(userEmail);$("#prof-username").val(p.username||userEmail.split('@')[0]);$("#prof-fullname").val(p.fullname||userName);$("#prof-contact").val(p.contact||"");}
$("#profile-form").submit(e=>{e.preventDefault();setProfile({username:$("#prof-username").val(),fullname:$("#prof-fullname").val(),contact:$("#prof-contact").val()});$("#profile-save-result").text("Saved!");});
function renderStatisticsTable(){let arr=getJobs(),todayCount=0,last7=0,last30=0,total=arr.length;
  let today=new Date();today.setHours(0,0,0,0);
  let last7date=new Date(today);last7date.setDate(today.getDate()-6);
  let last30date=new Date(today);last30date.setDate(today.getDate()-29);
  arr.forEach(j=>{let d=new Date(j.entryTime);d.setHours(0,0,0,0);if(d.getTime()===today.getTime()) todayCount++;if(d>=last7date) last7++;if(d>=last30date) last30++;});
  $("#statistics-holder").html(`<table class="table table-bordered table-dark text-center"><tr><th>Today</th><th>Last 7 Days</th><th>Last 30 Days</th><th>Total Records</th></tr><tr><td>${todayCount}</td><td>${last7}</td><td>${last30}</td><td>${total}</td></tr></table>`);
}

// Help/Issues
$("#help-form").submit(function(e){e.preventDefault();
  let msg=$("#help-message").val().trim();
  if(!msg) return $("#help-response").text("Please enter your issue.");
  let prof=getProfile();
  let issue={username:prof.username||userEmail.split('@')[0],fullname:prof.fullname||userName,time:new Date().toLocaleString(),message:msg};
  let issues=JSON.parse(localStorage.getItem("issues__")||"[]");
  issues.unshift(issue);
  localStorage.setItem("issues__",JSON.stringify(issues));
  $("#help-response").html('<span class="text-success">Issue reported successfully!</span>');
  $("#help-message").val("");
});
function renderAdminIssues(){let issues=JSON.parse(localStorage.getItem("issues__")||"[]");
  if(!issues.length) return $("#admin-issues-holder").html("<p class='text-muted'>No issues reported.</p>");
  let html="<table class='table table-bordered table-sm table-dark'><tr><th>Username</th><th>Full Name</th><th>Time</th><th>Message</th></tr>";
  issues.forEach(i=>{html+=`<tr><td>${escape(i.username)}</td><td>${escape(i.fullname)}</td><td>${escape(i.time)}</td><td>${escape(i.message)}</td></tr>`;});html+="</table>";
  $("#admin-issues-holder").html(html);
}

// Admin user clickable list with details popup
function getAllUserEmails(){
  return Object.keys(localStorage).filter(k=>k.startsWith('attendance_jobs__')).map(k=>k.replace('attendance_jobs__',''));
}
function getDurationStr(r){
  if(!r.entryTime||!r.exitTime) return "00:00";
  let et=new Date(r.entryTime),xt=new Date(r.exitTime);
  let ms=xt-et;
  if(isNaN(ms) || ms<60000) return "00:00";
  let mins=Math.floor(ms/60000),hrs=Math.floor(mins/60),m=mins%60;
  return String(hrs).padStart(2,"0")+":"+String(m).padStart(2,"0");
}
function renderAdminTable(){
  let users=getAllUserEmails();
  let list="<ul class='list-group'>";
  users.forEach(email=>{
    let p=getProfile(email)||{}, u=p.username||email.split('@')[0], f=p.fullname||"";
    list+=`<li class='list-group-item admin-user-row' data-email="${email}">${escape(f)} (${escape(u)})</li>`;
  });
  list+="</ul>";
  $("#admin-users-list").html(list);
  $("#admin-user-details").empty();
  $(".admin-user-row").off().click(function(){ showAdminUserDetails($(this).data("email"));});
  renderAdminIssues();
  $("#admin-export").off().click(function(){
    let rows=[];
    users.forEach(email=>{
      let p=getProfile(email)||{};
      getJobs(email).forEach(r=>{
        rows.push({
          Email: email,
          Username: p.username||"",
          FullName: p.fullname||"",
          Contact: p.contact||"",
          Place: `(${r.place}${r.zipcode ? ", "+r.zipcode : ""})`,
          Entry: r.entryTime,
          Exit: r.exitTime||"",
          Duration: getDurationStr(r),
          Status: r.status
        });
      });
    });
    let wb=XLSX.utils.book_new();
    XLSX.utils.book_append_sheet(wb,XLSX.utils.json_to_sheet(rows),"Attendance");
    XLSX.writeFile(wb,"attendance.xlsx");
  });
}
function showAdminUserDetails(email){
  let p=getProfile(email)||{}, u=p.username||email.split('@')[0], f=p.fullname||"";
  let recs=getJobs(email);
  let html=`<div class='mt-3 mb-2'><strong>${escape(f)} (${escape(u)})</strong></div>`;
  if(!recs.length){html+="<p class='text-muted'>No records.</p>"; return $("#admin-user-details").html(html);}
  html+="<table class='table table-bordered admin-record-table'><tr><th>Place (ZIP)</th><th>Entry</th><th>Exit</th><th>Duration</th><th>Status</th></tr>";
  recs.forEach(r=>{
    html+=`<tr>
      <td>(${escape(r.place)}${r.zipcode?", "+escape(r.zipcode):""})</td>
      <td>${escape(r.entryTime)||""}</td>
      <td>${escape(r.exitTime)||""}</td>
      <td>${getDurationStr(r)}</td>
      <td>${escape(r.status)||""}</td>
    </tr>`;
  });
  html+="</table>";
  $("#admin-user-details").html(html);
}

window.onload=function(){initMap();renderAttendanceCards();renderStatisticsTable();loadProfile();if(userEmail===allowedAdminEmail) renderAdminTable();};
$('.nav-link[data-sec="statistics"]').click(renderStatisticsTable);
$('.nav-link[data-sec="profile"]').click(loadProfile);
$('.nav-link[data-sec="admin"]').click(renderAdminTable);
$('.nav-link[data-sec="dashboard"]').click(renderAttendanceCards);
</script>
</body>
</html>
